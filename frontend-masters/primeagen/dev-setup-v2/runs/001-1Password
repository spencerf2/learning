#!/usr/bin/env bash

### This file is not part of the course.
###

echo "Setting up 1Password CLI and SSH..."

# Install 1Password CLI if not already installed
if ! command -v op &> /dev/null; then
    echo "Installing 1Password CLI..."
    brew install --cask 1password
    brew install 1password-cli
fi

# Log in to 1Password (this will require user interaction)
if ! op account list &> /dev/null; then
    echo "Please sign in to 1Password CLI..."
    op signin
fi

# Create SSH directory if it doesn't exist
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# Get SSH key from 1Password and add to SSH directory
# Replace 'Github SSH Key' with the actual item name in your 1Password vault
echo "Getting SSH key from 1Password..."
op item get "Github SSH Key" --fields "private key" > ~/.ssh/id_rsa
op item get "Github SSH Key" --fields "public key" > ~/.ssh/id_rsa.pub

# Set proper permissions
chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub

# Add the SSH key to the SSH agent
ssh-add ~/.ssh/id_rsa

echo "1Password and SSH setup complete!"

